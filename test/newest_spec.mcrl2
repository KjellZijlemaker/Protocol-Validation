sort TComm = struct undetected | detectedupper | detectedlower | detectedrightmost | detectedleftmost | unpressed | pressed;

act
	s1, r1, c1, r2, s2, c2: TComm;
	moving, stop, detect, press;
	enablehorizontalbrake, releasehorizontalbrake, enableverticalbrake, releaseverticalbrake;

proc
	M = r1(undetected).r2(pressed).releaseverticalbrake.moving.M + ((r1(detectedupper) + r1(detectedlower)).enableverticalbrake+(r1(detectedrightmost) + r1(detectedleftmost)).enablehorizontalbrake + r2(unpressed)).stop.M;
	S1 = s1(undetected).S1 + detect.(s1(detectedupper) + s1(detectedlower) + s1(detectedleftmost) + s1(detectedrightmost)).S1;
	B1 = s2(unpressed).B1 + press.B2;
	B2 = s2(pressed).B1;

init
	allow({ c1, c2, moving, stop, detect, press, enableverticalbrake,enablehorizontalbrake, releaseverticalbrake,releasehorizontalbrake},
		comm(
			{
				s1|r1 -> c1,
				s2|r2 -> c2
			},
			M || S1 || B1 || B2
		)
	);